### **第 4 章 幾何查詢與操作**

---

#### **4.1 點是否在多邊形內測試（Point-in-Polygon）**  
判斷一個點是否位於多邊形內部是計算幾何中的經典問題，廣泛應用於地理信息系統和電腦圖形學。

- **問題描述**  
  - 給定一個點 \( P(x, y) \) 和一個多邊形 \( \mathcal{P} \)（由頂點按順序定義），判斷 \( P \) 是否在 \( \mathcal{P} \) 的內部、邊界上，或外部。

- **演算法方法**  
  1. **射線法（Ray-Casting Method）**  
     - 方法：從點 \( P \) 向任意方向發射一條射線，計算射線與多邊形邊的交點數。  
     - 判斷規則：  
       - 若交點數為奇數，則點在多邊形內部；  
       - 若交點數為偶數，則點在外部。  
     - 時間複雜度：\( O(n) \)，其中 \( n \) 為多邊形頂點數。

  2. **奇偶法則優化**  
     - 將射線法優化以處理邊界情況（如射線穿過頂點）。  
     - 使用浮點數比較的精度處理，避免錯誤判定。

  3. **三角剖分法**  
     - 方法：將多邊形分解為若干三角形，檢查點是否位於任意一個三角形內。  
     - 適合凸多邊形和少量查詢的場合。  

- **應用案例**  
  - 地圖導航中點是否在區域內的測試。  
  - 遊戲中角色是否位於障礙物內的判斷。

---

#### **4.2 線段相交測試（Segment Intersection）**  
判斷兩條線段是否相交是計算幾何中的重要基礎問題。

- **問題描述**  
  - 給定兩條線段 \( AB \) 和 \( CD \)，判斷它們是否相交，並計算相交點（若存在）。

- **幾何條件**  
  - 對於線段 \( AB \) 和 \( CD \)，它們相交當且僅當：  
    1. \( AB \) 的兩端點位於 \( CD \) 的兩側；  
    2. \( CD \) 的兩端點位於 \( AB \) 的兩側。  

- **演算法方法**  
  1. **叉積法（Cross Product Method）**  
     - 使用叉積判斷點是否在另一條線段的不同側。  
     - 計算公式：  
       \[
       \text{方向向量叉積} = \mathbf{AC} \times \mathbf{AB}, \mathbf{AD} \times \mathbf{AB}
       \]  
     - 若叉積符號相反，則點位於線段的不同側。

  2. **快速排斥檢測（Bounding Box Test）**  
     - 檢查線段的外接矩形是否重疊，若不重疊則一定不相交。

  3. **精確相交測試**  
     - 在排除明顯不相交的情況後，進一步計算交點的坐標，使用參數方程解聯立方程組。  

- **時間複雜度**  
  - 單次測試：\( O(1) \)。  
  - 多條線段的批量測試：可使用掃描線法，時間複雜度 \( O(n \log n) \)。

- **應用案例**  
  - 路徑規劃中檢查路徑是否碰撞。  
  - 幾何渲染中處理線條與圖形的交互。

---

#### **4.3 最近點對問題（Closest Pair of Points）**  
找到一組最近的點對在多個應用中具有關鍵作用，例如圖形處理與機器學習。

- **問題描述**  
  - 給定 \( n \) 個點的集合，找到距離最近的兩個點 \( P_i \) 和 \( P_j \)。

- **演算法方法**  
  1. **暴力解法**  
     - 遍歷所有點對，計算其歐幾里得距離。  
     - 時間複雜度：\( O(n^2) \)。

  2. **分治法（Divide and Conquer）**  
     - 思路：  
       - 將點集按 x 坐標排序並劃分為兩部分；  
       - 遞歸解決每部分的最近點對；  
       - 合併時處理跨越分界線的最近點對。  
     - 關鍵優化：  
       - 在合併階段，只檢查分界線附近寬度為最近距離的帶狀區域內的點。  
     - 時間複雜度：\( O(n \log n) \)。

  3. **掃描線法**  
     - 使用動態數據結構記錄掃描線附近的點，逐步更新最近點對。  
     - 適用於在線性時間內處理多次查詢的情況。

- **應用案例**  
  - 最近鄰查詢（例如搜索最近的店鋪或服務點）。  
  - 集群分析中計算點的密集區域。  
  - 計算幾何中的碰撞檢測。

---

這一章介紹了三個核心幾何查詢與操作問題，涵蓋了基本理論、演算法細節及應用場景，幫助讀者在實際中快速解決相關問題。